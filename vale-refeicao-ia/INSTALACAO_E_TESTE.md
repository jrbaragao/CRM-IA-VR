# üöÄ Guia de Instala√ß√£o e Teste - Vale Refei√ß√£o IA

## üìã Pr√©-requisitos

Certifique-se de ter instalado:
- ‚úÖ Python 3.11 ou superior
- ‚úÖ SQLite (inclu√≠do no Python) ou PostgreSQL 14+
- ‚úÖ Git
- ‚úÖ At√© 2GB de RAM dispon√≠vel para an√°lises grandes

## üîß Instala√ß√£o Passo a Passo

### 1. Clone o Reposit√≥rio (se ainda n√£o tiver)

```bash
# Se voc√™ j√° tem o projeto, pule esta etapa
git clone https://github.com/seu-usuario/vale-refeicao-ia.git
cd vale-refeicao-ia
```

### 2. Crie o Ambiente Virtual

```bash
# No Windows (PowerShell)
python -m venv venv
.\venv\Scripts\Activate

# No Windows (CMD)
python -m venv venv
venv\Scripts\activate

# No Linux/Mac
python -m venv venv
source venv/bin/activate
```

### 3. Instale as Depend√™ncias

```bash
# Instale todas as depend√™ncias incluindo bibliotecas de visualiza√ß√£o
pip install -r requirements.txt

# Ou se preferir instalar individualmente:
pip install streamlit pandas numpy sqlalchemy
pip install openai llama-index matplotlib seaborn
pip install xlsxwriter openpyxl
```

### 4. Configure o Banco de Dados

#### Op√ß√£o A: SQLite (Recomendado para Teste) üì¶

```bash
# Windows PowerShell
.\configurar_sqlite.ps1

# Windows CMD
configurar_sqlite.bat

# Ou crie manualmente o arquivo .env:
echo "DATABASE_URL=sqlite:///./vale_refeicao.db" > .env
echo "OPENAI_API_KEY=sk-sua-chave-aqui" >> .env
```

#### Op√ß√£o B: Usando Docker (PostgreSQL) üê≥

```bash
# Inicie o PostgreSQL e ChromaDB com Docker Compose
docker-compose up -d

# Verifique se os containers est√£o rodando
docker ps
```

#### Op√ß√£o B: PostgreSQL Local

Se voc√™ tem PostgreSQL instalado localmente:

```sql
-- Conecte ao PostgreSQL e execute:
CREATE DATABASE vale_refeicao;
CREATE USER vr_user WITH PASSWORD 'sua_senha_segura';
GRANT ALL PRIVILEGES ON DATABASE vale_refeicao TO vr_user;
```

### 5. Configure as Vari√°veis de Ambiente

Crie um arquivo `.env` na raiz do projeto:

```bash
# Copie este conte√∫do para o arquivo .env
# Banco de Dados
DATABASE_URL=postgresql://vr_user:sua_senha_segura@localhost:5432/vale_refeicao

# OpenAI
OPENAI_API_KEY=sk-... # Sua chave da OpenAI

# ChromaDB
CHROMA_HOST=localhost
CHROMA_PORT=8000

# Configura√ß√µes de Vale Refei√ß√£o
VALOR_DIA_UTIL=35.00
DESCONTO_FUNCIONARIO_PCT=0.20
DIAS_UTEIS_MES=22

# Ambiente
ENVIRONMENT=development
DEBUG=True

# Configura√ß√µes de Upload
MAX_FILE_SIZE_MB=50
ALLOWED_EXTENSIONS=csv,xlsx,xls
```

### 6. Execute as Migra√ß√µes do Banco

```bash
# Crie as tabelas no banco de dados
alembic upgrade head

# Se alembic n√£o estiver configurado, voc√™ pode criar as tabelas manualmente:
python -c "from src.data.models import Base, engine; Base.metadata.create_all(engine)"
```

## üéØ Testando a Aplica√ß√£o

### 1. Inicie o Streamlit

```bash
# Certifique-se que o ambiente virtual est√° ativo
streamlit run app.py
```

A aplica√ß√£o abrir√° automaticamente em: http://localhost:8501

#### üîÑ Como Reiniciar Ap√≥s Mudan√ßas:
```bash
# 1. No terminal onde o Streamlit est√° rodando:
Ctrl + C  # Para o servidor

# 2. Inicie novamente:
streamlit run app.py

# Ou use auto-reload para desenvolvimento:
streamlit run app.py --server.runOnSave true
```

### 2. Prepare Arquivos de Teste

#### Para Vale Refei√ß√£o:
Crie planilhas Excel/CSV com colunas como:
- **MATRICULA** (ou escolha outra coluna como √≠ndice)
- **NOME**
- **SINDICATO**
- **DATA_ADMISSAO**
- **STATUS**

#### Para An√°lise Explorat√≥ria (Qualquer Dataset):
- **Vendas**: produto, quantidade, pre√ßo, data, categoria
- **Clientes**: id, idade, cidade, renda, score
- **Estoque**: sku, quantidade, custo, fornecedor
- **Qualquer CSV**: O sistema se adapta automaticamente

### 3. Fluxo de Teste Completo

#### ‚ö†Ô∏è IMPORTANTE: O sistema tem 2 etapas separadas!

1. **Upload** ‚Üí Apenas carrega arquivos na mem√≥ria
2. **Prepara√ß√£o de Dados** ‚Üí Salva no banco de dados

#### Passo 1: Upload de Arquivos
1. Acesse a p√°gina "üì§ Upload"
2. Arraste ou selecione arquivos (at√© 500MB)
3. Para cada arquivo:
   - Marque "Definir coluna de indexa√ß√£o" (opcional)
   - Escolha a coluna desejada como chave prim√°ria
4. **IMPORTANTE**: Ap√≥s upload, v√° para "üîÑ Prepara√ß√£o de Dados" no menu lateral

#### Passo 2: Prepara√ß√£o de Dados (OBRIGAT√ìRIO!)
1. Acesse a p√°gina "üîÑ Prepara√ß√£o de Dados" 
2. Clique em "Iniciar Processamento"
3. Aguarde o agente:
   - Limpar dados
   - Criar tabelas no banco
   - Salvar registros
4. S√≥ ap√≥s isso os dados estar√£o dispon√≠veis

#### Passo 3: An√°lise Explorat√≥ria de Dados (NOVO!)
1. V√° para "Banco de Dados" ‚Üí "Buscas (Query)"
2. Na aba "Agente Aut√¥nomo", digite:
   - "Fa√ßa uma an√°lise explorat√≥ria completa dos dados"
   - "Identifique outliers e correla√ß√µes"
   - "Mostre estat√≠sticas e distribui√ß√µes"
3. Visualize os resultados em 5 abas:
   - üìà Estat√≠sticas
   - üìä Distribui√ß√µes
   - üîó Correla√ß√µes
   - üéØ Outliers
   - üí° Insights

#### Passo 4: Agentes de IA
1. V√° para "Agentes de IA"
2. Configure uma nova an√°lise:
   - Nome: "An√°lise Completa EDA"
   - Ferramentas: Marque "üìä An√°lise Explorat√≥ria (EDA)"
   - Prompt: Descreva sua an√°lise desejada
3. Execute e acompanhe em tempo real

#### Passo 5: Exporta√ß√£o e Relat√≥rios
1. Os resultados incluem:
   - Estat√≠sticas completas
   - Gr√°ficos (quando solicitados)
   - Recomenda√ß√µes autom√°ticas
2. Exporte para Excel com todas as an√°lises
   - Resumo por departamento
   - Distribui√ß√£o de valores
   - Estat√≠sticas gerais
3. Exporte para PDF ou Excel

## üß™ Testes Automatizados

```bash
# Execute os testes unit√°rios
pytest

# Com cobertura
pytest --cov=src --cov-report=html

# Testes espec√≠ficos
pytest tests/test_agents.py -v
pytest tests/test_calculations.py -v
```

## üêõ Troubleshooting

### Erro: "OPENAI_API_KEY not found"
```bash
# Verifique se o arquivo .env existe e cont√©m:
OPENAI_API_KEY=sk-...
```

### Erro: "Cannot connect to PostgreSQL"
```bash
# Verifique se o PostgreSQL est√° rodando
docker ps

# Ou se instalado localmente:
pg_isready -h localhost -p 5432
```

### Erro: "ChromaDB connection failed"
```bash
# Inicie o ChromaDB
docker-compose up chroma -d

# Ou use o modo em mem√≥ria (desenvolvimento)
# Altere no .env: CHROMA_PERSIST=False
```

### Erro: "Module not found"
```bash
# Reinstale as depend√™ncias
pip install -r requirements.txt --force-reinstall
```

## üìä Dados de Exemplo

Crie um arquivo `exemplo_funcionarios.csv`:

```csv
MATRICULA,NOME,CPF,DEPARTAMENTO,DATA_ADMISSAO,SALARIO,DIAS_TRABALHADOS
1001,Jo√£o Silva,123.456.789-00,TI,2023-01-15,5000.00,22
1002,Maria Santos,987.654.321-00,RH,2022-06-20,4500.00,20
1003,Pedro Oliveira,456.789.123-00,Vendas,2023-03-10,3800.00,22
```

## üÜï Novos Recursos de An√°lise Explorat√≥ria

### üìä An√°lises Dispon√≠veis

1. **Estat√≠sticas Descritivas**
   - M√©dia, mediana, desvio padr√£o
   - Quartis e percentis
   - Valores m√≠nimos e m√°ximos

2. **An√°lise de Distribui√ß√µes**
   - Detec√ß√£o de normalidade
   - Assimetria (skewness) e curtose
   - Recomenda√ß√µes de transforma√ß√£o

3. **Detec√ß√£o de Outliers**
   - M√©todo IQR autom√°tico
   - Contagem e percentual por coluna
   - Valores espec√≠ficos identificados

4. **An√°lise de Correla√ß√µes**
   - Matriz completa de correla√ß√µes
   - Identifica√ß√£o de pares fortemente correlacionados
   - Visualiza√ß√£o em heatmap (quando solicitado)

5. **Valores Ausentes**
   - Contagem por coluna
   - Padr√µes de aus√™ncia
   - Recomenda√ß√µes de tratamento

### üéØ Exemplos de Perguntas para o Agente

```
"An√°lise completa da tabela vendas"
"Quais colunas t√™m outliers?"
"Mostre as correla√ß√µes entre pre√ßo e quantidade"
"Identifique padr√µes temporais nos dados"
"Quais vari√°veis t√™m distribui√ß√£o normal?"
"Detecte anomalias no dataset"
```

## üîç Verifica√ß√£o de Sa√∫de

Execute este script para verificar se tudo est√° funcionando:

```python
# test_health.py
import os
from dotenv import load_dotenv
import sqlalchemy
import openai
import pandas as pd
import matplotlib
import seaborn

load_dotenv()

# Teste 1: Vari√°veis de Ambiente
print("‚úÖ Teste 1: Vari√°veis de Ambiente")
assert os.getenv("OPENAI_API_KEY"), "‚ùå OPENAI_API_KEY n√£o configurada"
assert os.getenv("DATABASE_URL"), "‚ùå DATABASE_URL n√£o configurada"
print("‚úÖ Vari√°veis OK")

# Teste 2: Banco de Dados
print("\n‚úÖ Teste 2: Banco de Dados")
try:
    engine = sqlalchemy.create_engine(os.getenv("DATABASE_URL"))
    engine.connect()
    print("‚úÖ Banco de Dados OK")
except Exception as e:
    print(f"‚ùå Database Error: {e}")

# Teste 3: OpenAI
print("\n‚úÖ Teste 3: OpenAI")
try:
    openai.api_key = os.getenv("OPENAI_API_KEY")
    print("‚úÖ OpenAI configurada")
except Exception as e:
    print(f"‚ùå OpenAI Error: {e}")

# Teste 4: Bibliotecas de An√°lise
print("\n‚úÖ Teste 4: Bibliotecas de An√°lise")
try:
    import matplotlib.pyplot as plt
    import seaborn as sns
    print("‚úÖ Matplotlib e Seaborn OK")
except Exception as e:
    print(f"‚ùå Visualization Error: {e}")

print("\nüéâ Todos os testes passaram! A aplica√ß√£o est√° pronta para uso.")
```

## üöÄ In√≠cio R√°pido

```bash
# Comando √∫nico para iniciar tudo (Windows PowerShell)
docker-compose up -d; python -m venv venv; .\venv\Scripts\Activate; pip install -r requirements.txt; streamlit run app.py

# Linux/Mac
docker-compose up -d && python -m venv venv && source venv/bin/activate && pip install -r requirements.txt && streamlit run app.py
```

## üìû Suporte

Se encontrar problemas:
1. Verifique os logs: `streamlit run app.py --logger.level=debug`
2. Consulte a documenta√ß√£o: `README.md` e `DEPLOY.md`
3. Verifique os requisitos: Python 3.11+, PostgreSQL 14+

## ‚úÖ Checklist de Instala√ß√£o

- [ ] Python 3.11+ instalado
- [ ] PostgreSQL rodando
- [ ] Ambiente virtual criado
- [ ] Depend√™ncias instaladas
- [ ] Arquivo .env configurado
- [ ] Banco de dados criado
- [ ] Tabelas migradas
- [ ] OpenAI API key v√°lida
- [ ] Streamlit rodando
- [ ] Upload de teste realizado

Quando todos os itens estiverem marcados, sua instala√ß√£o est√° completa! üéâ
